import{d as R,o as T,j,c as o,a as r,b as p,k as E,t as _,F as b,r as q,i as x,w as M,u as U,f as c,l as g,g as C,h as n,n as A,m as G,_ as H}from"./index-BQ5N97Dc.js";import{g as J,a as K}from"./food-D3suAVUb.js";const O={class:"list-page"},P={class:"header"},Q={class:"header-title"},W={key:0,class:"tabs"},X=["onClick"],Y=["onClick"],Z={class:"card-left"},ee={class:"item-name"},te={key:0,class:"item-sub"},ae={class:"card-right"},L=10,se=R({__name:"List",setup(oe){const u=G(),d=U(),f=c([]),l=c(!1),i=c(!1),y=c(0),s=c([]),v=g(()=>{const e=Number(u.query.category_id);return Number.isFinite(e)&&e>0?e:0}),h=g(()=>{const e=u.query.category_code;return e?String(e).trim():""}),m=g(()=>v.value),N=g(()=>s.value.find(a=>a.id===m.value)?.name||"列表"),S=()=>{f.value=[],y.value=0,i.value=!1,l.value=!1},w=async()=>{if(!s.value.length)try{const e=await J();s.value=e.categories||[]}catch{s.value=[]}},k=async()=>{if(await w(),v.value>0||h.value)return;const e=s.value[0];e?await d.replace({path:"/list",query:{category_id:String(e.id)}}):i.value=!0},I=async()=>{if(!v.value&&!h.value){l.value=!1,await k();return}try{const e=await K({category_id:v.value||void 0,category_code:h.value||void 0,offset:y.value,limit:L});if(e.categories&&e.categories.length>0&&e.categories[0]){const a=e.categories[0].items||[];f.value.push(...a),y.value+=a.length,a.length<L&&(i.value=!0)}else i.value=!0}catch{i.value=!0}finally{l.value=!1}},$=e=>{d.push(`/detail/${e}`)},B=async e=>{m.value!==e&&await d.push({path:"/list",query:{category_id:String(e)}})};return T(async()=>{await k()}),j(()=>[u.query.category_id,u.query.category_code],async()=>{await w(),S()}),(e,a)=>{const F=C("van-icon"),V=C("van-image"),z=C("van-list");return n(),o("div",O,[r("div",P,[p(F,{name:"arrow-left",color:"#fff",size:"20",onClick:a[0]||(a[0]=t=>E(d).back())}),r("span",Q,_(N.value),1),a[2]||(a[2]=r("span",{style:{width:"20px"}},null,-1))]),s.value.length?(n(),o("div",W,[(n(!0),o(b,null,q(s.value,t=>(n(),o("button",{key:t.id,class:A(["tab",{active:m.value===t.id}]),type:"button",onClick:D=>B(t.id)},_(t.name),11,X))),128))])):x("",!0),p(z,{loading:l.value,"onUpdate:loading":a[1]||(a[1]=t=>l.value=t),finished:i.value,"finished-text":"没有更多了",onLoad:I,class:"list-container"},{default:M(()=>[(n(!0),o(b,null,q(f.value,t=>(n(),o("div",{key:t.id,class:"food-card",onClick:D=>$(t.id)},[r("div",Z,[r("div",ee,_(t.title),1),t.subtitle?(n(),o("div",te,_(t.subtitle),1)):x("",!0)]),r("div",ae,[p(V,{src:t.cover_url,fit:"cover",class:"item-img"},null,8,["src"])])],8,Y))),128))]),_:1},8,["loading","finished"])])}}}),re=H(se,[["__scopeId","data-v-80aad45d"]]);export{re as default};
