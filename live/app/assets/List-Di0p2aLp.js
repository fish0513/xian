import{d as I,b as N,k as B,c as l,e as h,F as k,g as w,l as R,w as A,h as i,m as d,i as D,u as T,n as V,t as $,j,p as z,o as n,q as E,_ as H}from"./index-Bspw2Z-2.js";import{g as M,a as U}from"./live-CLNhgl63.js";import{A as G,F as J}from"./AppHeader-Ctqw4dx-.js";const K={class:"list-page"},O={key:0,class:"tabs"},P=["onClick"],b=10,Q=I({__name:"List",setup(W){const c=z(),u=T(),g=i([]),r=i(!1),o=i(!1),y=i(0),s=i([]),v=d(()=>{const e=Number(c.query.category_id);return Number.isFinite(e)&&e>0?e:0}),f=d(()=>{const e=c.query.category_code;return e?String(e).trim():""}),_=d(()=>v.value),C=d(()=>s.value.find(a=>a.id===_.value)?.name||"列表"),q=()=>{g.value=[],y.value=0,o.value=!1,r.value=!1},p=async()=>{if(!s.value.length)try{const e=await M();s.value=e.categories||[]}catch{s.value=[]}},m=async()=>{if(await p(),v.value>0||f.value)return;const e=s.value[0];e?await u.replace({path:"/list",query:{category_id:String(e.id)}}):o.value=!0},x=async()=>{if(!v.value&&!f.value){r.value=!1,await m();return}try{const e=await U({category_id:v.value||void 0,category_code:f.value||void 0,offset:y.value,limit:b});if(e.categories&&e.categories.length>0&&e.categories[0]){const a=e.categories[0].items||[];g.value.push(...a),y.value+=a.length,a.length<b&&(o.value=!0)}else o.value=!0}catch{o.value=!0}finally{r.value=!1}},F=e=>{u.push(`/detail/${e}`)},L=async e=>{_.value!==e&&await u.push({path:"/list",query:{category_id:String(e)}})};return N(async()=>{await m()}),B(()=>[c.query.category_id,c.query.category_code],async()=>{await p(),q()}),(e,a)=>{const S=D("van-list");return n(),l("div",K,[h(G,{title:C.value,"show-back":!0,"on-back":()=>E(u).back()},null,8,["title","on-back"]),s.value.length?(n(),l("div",O,[(n(!0),l(k,null,w(s.value,t=>(n(),l("button",{key:t.id,class:V(["tab",{active:_.value===t.id}]),type:"button",onClick:X=>L(t.id)},$(t.name),11,P))),128))])):R("",!0),h(S,{loading:r.value,"onUpdate:loading":a[0]||(a[0]=t=>r.value=t),finished:o.value,"finished-text":"没有更多了",onLoad:x,class:"list-container"},{default:A(()=>[(n(!0),l(k,null,w(g.value,t=>(n(),j(J,{key:t.id,title:t.name,"cover-url":t.cover_url,"on-click":()=>F(t.id)},null,8,["title","cover-url","on-click"]))),128))]),_:1},8,["loading","finished"])])}}}),te=H(Q,[["__scopeId","data-v-4b0c497b"]]);export{te as default};
