import{d as I,b as N,k as T,c as l,e as m,F as b,g as k,l as B,w as R,h as i,m as d,i as A,u as D,n as V,t as $,j,p as z,o as n,q as E,_ as H}from"./index-BUVMfZ7q.js";import{g as M,a as U}from"./travel-CQg5PtGP.js";import{A as G,F as J}from"./AppHeader-Dm13B7hd.js";const K={class:"list-page"},O={key:0,class:"tabs"},P=["onClick"],w=10,Q=I({__name:"TravelList",setup(W){const c=z(),u=D(),g=i([]),r=i(!1),o=i(!1),f=i(0),s=i([]),v=d(()=>{const e=Number(c.query.category_id);return Number.isFinite(e)&&e>0?e:0}),y=d(()=>{const e=c.query.category_code;return e?String(e).trim():""}),_=d(()=>v.value),C=d(()=>s.value.find(a=>a.id===_.value)?.name||"列表"),q=()=>{g.value=[],f.value=0,o.value=!1,r.value=!1},p=async()=>{if(!s.value.length)try{const e=await M();s.value=e.categories||[]}catch{s.value=[]}},h=async()=>{if(await p(),v.value>0||y.value)return;const e=s.value[0];e?await u.replace({path:"/list",query:{category_id:String(e.id)}}):o.value=!0},x=async()=>{if(!v.value&&!y.value){r.value=!1,await h();return}try{const e=await U({category_id:v.value||void 0,category_code:y.value||void 0,offset:f.value,limit:w});if(e.categories&&e.categories.length>0&&e.categories[0]){const a=e.categories[0].items||[];g.value.push(...a),f.value+=a.length,a.length<w&&(o.value=!0)}else o.value=!0}catch{o.value=!0}finally{r.value=!1}},F=e=>{u.push(`/detail/${e}`)},L=async e=>{_.value!==e&&await u.push({path:"/list",query:{category_id:String(e)}})};return N(async()=>{await h()}),T(()=>[c.query.category_id,c.query.category_code],async()=>{await p(),q()}),(e,a)=>{const S=A("van-list");return n(),l("div",K,[m(G,{title:C.value,"show-back":!0,"on-back":()=>E(u).back()},null,8,["title","on-back"]),s.value.length?(n(),l("div",O,[(n(!0),l(b,null,k(s.value,t=>(n(),l("button",{key:t.id,class:V(["tab",{active:_.value===t.id}]),type:"button",onClick:X=>L(t.id)},$(t.name),11,P))),128))])):B("",!0),m(S,{loading:r.value,"onUpdate:loading":a[0]||(a[0]=t=>r.value=t),finished:o.value,"finished-text":"没有更多了",onLoad:x,class:"list-container"},{default:R(()=>[(n(!0),l(b,null,k(g.value,t=>(n(),j(J,{key:t.id,title:t.title,subtitle:t.subtitle,"cover-url":t.cover_url,"on-click":()=>F(t.id)},null,8,["title","subtitle","cover-url","on-click"]))),128))]),_:1},8,["loading","finished"])])}}}),te=H(Q,[["__scopeId","data-v-03f54cf8"]]);export{te as default};
